# TeleCoder Server
#
# Usage (from the project root):
#   docker compose -f docker/compose.yml --env-file .env up -d
#
# Or simply:
#   make docker-up
#
# This starts the TeleCoder server. Sandbox containers are created
# dynamically by the server when sessions are started.

services:
  server:
    build:
      context: ..
      dockerfile: docker/server.Dockerfile
    ports:
      - "7080:7080"
    volumes:
      - telecoder-data:/data
      - /var/run/docker.sock:/var/run/docker.sock
    env_file:
      - path: ../.env
        required: false
      - path: ${HOME}/.telecoder/config.env
        required: false
    environment:
      - TELECODER_ADDR=:7080
      - TELECODER_DATA_DIR=/data
      - TELECODER_DOCKER_IMAGE=telecoder-sandbox
      - TELECODER_DOCKER_NETWORK=telecoder-net
    networks:
      - telecoder-net
    restart: unless-stopped

networks:
  telecoder-net:
    name: telecoder-net

volumes:
  telecoder-data:
